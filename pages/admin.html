<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoBank - Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@auth0/auth0-spa-js@1.21.0/dist/auth0-spa-js.production.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/headerFooter.js"></script>
</head>
<body>
    <div id="header-placeholder"></div>
    <main id="admin-content" style="display: none;">
    </main>
    <div id="footer-placeholder"></div>

    <script>
        async function loadAdminContent() {
            await window.auth0Promise;
            const token = await getToken();
            if (!token) {
                window.location.href = '/pages/login.html';
                return;
            }

            try {
                const response = await fetch('/admin', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const htmlContent = await response.text();
                    document.getElementById('admin-content').innerHTML = htmlContent;
                    document.getElementById('admin-content').style.display = 'block';

                    const addStudentForm = document.getElementById('add-student-form');
                    if (addStudentForm) {
                        addStudentForm.addEventListener('submit', async (e) => {
                            e.preventDefault();
                            const studentName = document.getElementById('student-name').value;
                            alert("Student added successfully! (Implement backend logic)");
                            addStudentForm.reset();
                        });
                    }
                } else if (response.status === 403) {
                    alert('Access denied: Admins only.');
                    window.location.href = '/pages/dashboard.html';
                } else if (response.status === 401) {
                    alert('Please log in.');
                    window.location.href = '/pages/login.html';
                } else {
                    throw new Error('An error occurred');
                }
            } catch (error) {
                console.error('Error loading admin content:', error);
            }
        }

        loadAdminContent();
    </script>
</body>
</html>
